<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YouTube Downloader (RapidAPI) — Demo</title>
<style>
  :root{--bg:#071428;--card:#071a2b;--accent:#06b6d4;--muted:#9fb6c8}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto;background:linear-gradient(180deg,#041025,#071429);color:#e8f7fb;padding:14px}
  .wrap{max-width:920px;margin:0 auto}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
  h1{margin:0 0 6px;font-size:18px}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  label{display:block;margin-top:10px;color:var(--muted);font-size:13px}
  input[type=url], input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .row{display:flex;gap:8px;margin-top:8px}
  .btn{background:var(--accent);color:#022;padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .btn.sec{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .notice{font-size:13px;color:var(--muted);margin-top:8px}
  .result{margin-top:12px;display:grid;gap:10px}
  .media{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02)}
  .media .left{max-width:66%}
  a.link{padding:8px 10px;border-radius:7px;background:rgba(6,182,212,0.12);color:#cfefff;text-decoration:none;font-weight:600}
  img.thumb{width:100%;max-width:160px;border-radius:8px}
  @media(max-width:600px){ .row{flex-direction:column} .media{flex-direction:column;align-items:flex-start} a.link{display:block;margin-top:8px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>YouTube Downloader (RapidAPI)</h1>
      <p class="lead">Paste your RapidAPI key once, then paste a YouTube URL (or ID) and press Fetch. (Client-side demo)</p>

      <label>RapidAPI Key (x-rapidapi-key)</label>
      <div class="row">
        <input id="apiKey" type="text" placeholder="Paste your RapidAPI key here (stored locally)" />
        <button id="saveKey" class="btn sec">Save</button>
      </div>

      <label>Video URL or ID</label>
      <div class="row">
        <input id="videoInput" type="url" placeholder="https://www.youtube.com/watch?v=..." />
        <button id="fetchBtn" class="btn">Fetch</button>
      </div>

      <div id="status" class="notice"></div>

      <div id="info" class="result"></div>

      <div class="notice" style="margin-top:10px">
        <strong>Important:</strong> This demo uses a third-party RapidAPI. API quota/limits apply. Do not publish your API key publicly.
      </div>
    </div>
  </div>

<script>
  // Config: API host & base path
  const API_HOST = 'youtube-media-downloader.p.rapidapi.com';
  const API_BASE = 'https://' + API_HOST + '/v2/video/details';

  // UI refs
  const apiKeyEl = document.getElementById('apiKey');
  const saveKeyBtn = document.getElementById('saveKey');
  const videoInput = document.getElementById('videoInput');
  const fetchBtn = document.getElementById('fetchBtn');
  const statusEl = document.getElementById('status');
  const infoEl = document.getElementById('info');

  // Load stored key if any
  if(localStorage.getItem('rapid_key')) apiKeyEl.value = localStorage.getItem('rapid_key');

  saveKeyBtn.addEventListener('click', () => {
    const k = apiKeyEl.value.trim();
    if(!k) return alert('Paste your RapidAPI key first');
    localStorage.setItem('rapid_key', k);
    status('API key saved locally. (Visible on this device only)');
  });

  fetchBtn.addEventListener('click', async () => {
    clearInfo();
    const raw = videoInput.value.trim();
    if(!raw) return alert('Paste a YouTube URL or ID');
    const apiKey = localStorage.getItem('rapid_key') || apiKeyEl.value.trim();
    if(!apiKey) return alert('API key missing. Paste & Save it first.');

    // extract videoId from URL or accept direct ID
    const vid = extractYouTubeId(raw);
    if(!vid) return alert('Unable to parse video ID. Use a standard YouTube URL or just the ID.');
    status('Fetching metadata for video ID: ' + vid + ' ...');

    // build URL
    const qs = new URLSearchParams({ videoId: vid, urlAccess: 'normal', videos: 'auto', audios: 'auto' });
    const url = API_BASE + '?' + qs.toString();

    try {
      const r = await fetch(url, {
        method: 'GET',
        headers: {
          'x-rapidapi-host': API_HOST,
          'x-rapidapi-key': apiKey
        }
      });
      if(!r.ok){
        const txt = await r.text().catch(()=> '');
        throw new Error('API error ' + r.status + (txt ? (': '+txt) : ''));
      }
      const data = await r.json();
      renderResponse(data);
      status('Fetched — see results below.');
    } catch(err) {
      console.error(err);
      status('Error: ' + err.message);
      infoEl.innerHTML = `<div style="color:#f88">Request failed: ${escapeHtml(err.message)}</div>`;
    }
  });

  // helpers
  function status(msg){ statusEl.textContent = msg; }
  function clearInfo(){ infoEl.innerHTML = ''; status(''); }

  function extractYouTubeId(input){
    // if looks like ID (11+ chars, letters/numbers/_-)
    if(/^[A-Za-z0-9_-]{8,}$/.test(input) && !input.includes('/')) return input;
    try {
      const u = new URL(input);
      if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
      if(u.hostname.includes('youtube.com')){
        const v = u.searchParams.get('v');
        if(v) return v;
        // sometimes /embed/ID
        const parts = u.pathname.split('/');
        const idx = parts.indexOf('embed');
        if(idx >= 0 && parts[idx+1]) return parts[idx+1];
      }
    } catch(e){
      return null;
    }
    return null;
  }

  function renderResponse(data){
    // generic robust renderer: show title/thumbnail then list available media urls/formats
    infoEl.innerHTML = '';

    // title / thumbnail
    const top = document.createElement('div');
    top.style.display = 'flex';
    top.style.gap = '12px';
    top.style.alignItems = 'center';

    const thumb = document.createElement('img');
    thumb.className = 'thumb';
    thumb.src = data.thumbnail || data.thumb || '';
    thumb.alt = 'thumbnail';
    thumb.style.maxWidth = '160px';
    thumb.style.borderRadius = '8px';
    top.appendChild(thumb);

    const meta = document.createElement('div');
    meta.innerHTML = `<div style="font-weight:700">${escapeHtml(data.title || data.title_long || data.videoTitle || data.name || 'Untitled')}</div>
                      <div style="color:var(--muted);font-size:13px;margin-top:6px">${escapeHtml(data.uploader || data.author || data.owner || '')}</div>
                      <div style="color:var(--muted);font-size:12px;margin-top:8px">Duration: ${data.duration || data.length || '-'} sec</div>`;
    top.appendChild(meta);
    infoEl.appendChild(top);

    // Some APIs return arrays named formats, medias, streams or video/audio arrays.
    const candidates = data.formats || data.medias || data.streams || data.downloads || data.results || [];
    if(Array.isArray(candidates) && candidates.length){
      const list = document.createElement('div');
      list.style.marginTop = '12px';
      candidates.forEach((m, i) => {
        // try find a url in different fields
        const url = m.url || m.downloadUrl || m.source || m.link || m.mediaUrl || m.streamUrl;
        const ext = m.ext || m.extension || (m.mime && (m.mime.split('/').pop())) || '';
        const quality = m.quality || m.quality_label || m.format || m.format_note || (m.qualityString || '');
        const size = m.filesize || m.size || m.data_size || m.contentLength || null;

        const el = document.createElement('div');
        el.className = 'media';
        const left = document.createElement('div'); left.className='left';
        left.innerHTML = `<div style="font-weight:700">${escapeHtml(String(quality || ('format ' + (i+1))))} ${ext?(' • '+escapeHtml(ext)):''}</div>
                          <div style="color:var(--muted);font-size:13px">${size ? (humanFileSize(size)) : ''}</div>`;
        const right = document.createElement('div');
        if(url){
          const open = document.createElement('a'); open.className='link'; open.href = url; open.target='_blank'; open.textContent='Open';
          const dl = document.createElement('a'); dl.className='link'; dl.href = url; dl.target='_blank'; dl.textContent='Download'; dl.style.marginLeft='8px';
          right.appendChild(open); right.appendChild(dl);
        } else {
          right.innerHTML = `<small style="color:var(--muted)">No direct URL in this item</small>`;
        }
        el.appendChild(left); el.appendChild(right);
        list.appendChild(el);
      });
      infoEl.appendChild(list);
    } else {
      // fallback: maybe response directly contains urls fields
      const directUrl = data.downloadUrl || data.videoUrl || data.url || data.streamUrl;
      if(directUrl){
        const el = document.createElement('div'); el.className='media';
        el.innerHTML = `<div class="left"><div style="font-weight:700">Direct</div></div><div><a class="link" target="_blank" href="${escapeAttr(directUrl)}">Open / Download</a></div>`;
        infoEl.appendChild(el);
      } else {
        infoEl.innerHTML += `<div style="color:#fbb;margin-top:12px">No downloadable media found in API response. Inspect <code>console</code> for the full response.</div>`;
        console.log('API response (full):', data);
      }
    }
  }

  // helpers
  function humanFileSize(bytes){
    if(!bytes) return '';
    const b = Number(bytes);
    if(isNaN(b)) return '';
    const thresh = 1024;
    if(Math.abs(b) < thresh) return b + ' B';
    const units = ['KB','MB','GB','TB'];
    let u = -1;
    do { b = b / thresh; ++u; } while(Math.abs(b) >= thresh && u < units.length - 1);
    return b.toFixed(2) + ' ' + units[u];
  }

  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  function escapeAttr(s){ return String(s||'').replace(/"/g,'&quot;'); }

</script>
</body>
</html>
