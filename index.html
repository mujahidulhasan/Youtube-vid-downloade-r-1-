<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YouTube Downloader — RapidAPI (Final Version)</title>

<style>
  :root{--bg:#071428;--card:#071a2b;--accent:#06b6d4;--muted:#9fb6c8}
  body{
    margin:0;font-family:system-ui,Segoe UI,Roboto;
    background:linear-gradient(180deg,#041025,#071429);
    color:#e8f7fb;padding:14px
  }
  .wrap{max-width:920px;margin:0 auto}
  .card{
    background:var(--card);padding:14px;border-radius:14px;
    box-shadow:0 8px 30px rgba(2,6,23,0.6)
  }
  h1{margin:0 0 6px;font-size:20px}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  label{display:block;margin-top:12px;color:var(--muted);font-size:13px}
  input[type=url], input[type=text]{
    width:100%;padding:10px;border-radius:8px;
    border:1px solid rgba(255,255,255,0.07);
    background:transparent;color:inherit;
  }
  .row{display:flex;gap:8px;margin-top:8px}
  .btn{
    background:var(--accent);color:#022;padding:10px 12px;border-radius:8px;
    border:0;cursor:pointer;font-weight:700
  }
  .btn.sec{
    background:transparent;border:1px solid rgba(255,255,255,0.07);
    color:var(--muted)
  }
  .notice{font-size:13px;color:var(--muted);margin-top:10px}
  .result{margin-top:16px;display:grid;gap:12px}

  .media{
    display:flex;justify-content:space-between;align-items:center;
    padding:12px;border-radius:10px;background:rgba(255,255,255,0.04)
  }
  .media .left{max-width:70%}

  a.link{
    padding:8px 10px;border-radius:7px;background:rgba(6,182,212,0.18);
    color:#cfefff;text-decoration:none;font-weight:600
  }

  img.thumb{max-width:160px;border-radius:8px}

  pre.raw{
    white-space:pre-wrap;background:#02121a;color:#9fe;
    padding:12px;border-radius:10px;margin-top:12px
  }

  @media(max-width:600px){
    .row{flex-direction:column}
    .media{flex-direction:column;align-items:flex-start}
    a.link{margin-top:8px;display:block}
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>YouTube Downloader (RapidAPI)</h1>
    <p class="lead">Paste API key → YouTube URL → Fetch → Download links appear.</p>

    <label>RapidAPI Key</label>
    <div class="row">
      <input id="apiKey" type="text" placeholder="Paste your RapidAPI key" />
      <button id="saveKey" class="btn sec">Save</button>
    </div>

    <label>YouTube URL / Video ID</label>
    <div class="row">
      <input id="videoInput" type="url" placeholder="https://youtu.be/ID or full link" />
      <button id="fetchBtn" class="btn">Fetch</button>
    </div>

    <div id="status" class="notice"></div>
    <div id="info" class="result"></div>

    <div class="notice">⚠ API key public-এ শেয়ার করবেন না।</div>
  </div>
</div>

<script>
const API_HOST = "youtube-media-downloader.p.rapidapi.com";
const API_URL  = "https://" + API_HOST + "/v2/video/details";

const apiKeyEl = document.getElementById("apiKey");
const videoInput = document.getElementById("videoInput");
const saveKeyBtn = document.getElementById("saveKey");
const fetchBtn = document.getElementById("fetchBtn");
const statusEl = document.getElementById("status");
const infoEl = document.getElementById("info");

// load saved key
if(localStorage.getItem("rapid_key"))
  apiKeyEl.value = localStorage.getItem("rapid_key");

// save key
saveKeyBtn.addEventListener("click", ()=>{
  let k = apiKeyEl.value.trim();
  if(!k) return alert("Paste your API key first");
  localStorage.setItem("rapid_key", k);
  status("API key saved");
});

// fetch events
fetchBtn.addEventListener("click", ()=> {
  const url = videoInput.value.trim();
  if(!url) return alert("Paste URL or ID");

  const key = localStorage.getItem("rapid_key") || apiKeyEl.value.trim();
  if(!key) return alert("API key missing");

  const vid = extractID(url);
  if(!vid) return alert("Invalid YouTube URL / ID");

  fetchVideo(vid, key);
});

function status(msg){ statusEl.textContent = msg; }
function clear(){ infoEl.innerHTML = ""; status(""); }

// Extract video ID
function extractID(x){
  if(/^[A-Za-z0-9_-]{8,}$/.test(x) && !x.includes("/")) return x;
  try{
    const u = new URL(x);
    if(u.hostname.includes("youtu.be")) return u.pathname.slice(1);
    if(u.hostname.includes("youtube.com")){
      const v = u.searchParams.get("v");
      if(v) return v;
      const p = u.pathname.split("/");
      const i = p.indexOf("embed");
      if(i>=0 && p[i+1]) return p[i+1];
    }
  }catch(err){}
  return null;
}

// MAIN FETCH + DEBUG DISPLAY
async function fetchVideo(videoId, key){
  clear();
  status("Fetching...");

  const q = new URLSearchParams({
    videoId: videoId,
    urlAccess: "normal",
    videos: "auto",
    audios: "auto"
  });

  try{
    const r = await fetch(API_URL + "?" + q.toString(), {
      method: "GET",
      headers: {
        "x-rapidapi-host": API_HOST,
        "x-rapidapi-key": key
      }
    });

    const raw = await r.text();
    let data;
    try{ data = JSON.parse(raw); }
    catch{ data = raw; }

    console.log("RAW API RESPONSE:", data);

    // show raw JSON on page
    const pre = document.createElement("pre");
    pre.className = "raw";
    pre.textContent = typeof data === "string"
        ? data
        : JSON.stringify(data, null, 2);
    infoEl.appendChild(pre);

    // Friendly renderer
    const box = document.createElement("div");
    box.style.marginTop = "10px";
    infoEl.appendChild(box);

    renderFinal(data, box);
    status("Done.");

  }catch(e){
    status("Error: " + e.message);
    infoEl.innerHTML = "<div style='color:#f88'>Fetch failed: "+e.message+"</div>";
  }
}

// FRIENDLY RENDERER (FINAL)
function renderFinal(data, container){
  if(!data || typeof data !== 'object'){
    container.innerHTML = '<div style="color:#faa">Invalid response</div>';
    return;
  }

  // Header
  const title = data.title || "Unknown title";
  const thumb = (data.thumbnails && data.thumbnails[0] && data.thumbnails[0].url) || data.thumbnail || "";
  const author = (data.channel && data.channel.name) || data.author || "";
  const dur = data.lengthSeconds || data.duration || "-";

  const head = document.createElement("div");
  head.style.display = 'flex';
  head.style.gap = '12px';

  if(thumb){
    const img = document.createElement("img");
    img.src = thumb;
    img.className = "thumb";
    head.appendChild(img);
  }

  const meta = document.createElement("div");
  meta.innerHTML = `
     <div style="font-weight:700">${escapeHtml(title)}</div>
     <div style="color:#9fb6c8;font-size:13px">${escapeHtml(author)}</div>
     <div style="color:#9fb6c8;font-size:12px;margin-top:6px">Duration: ${dur} sec</div>`;
  head.appendChild(meta);
  container.appendChild(head);

  // expiration (if any)
  if(data.videos && data.videos.expiration){
    const t = new Date(data.videos.expiration * 1000);
    const ex = document.createElement("div");
    ex.style.color = "#9fb6c8";
    ex.style.marginTop = "8px";
    ex.textContent = "Links expire: " + t;
    container.appendChild(ex);
  }

  // Collect media lists
  const lists = [];
  if(data.videos && Array.isArray(data.videos.items))
    lists.push({ key:"videos.items", list:data.videos.items });

  ["medias","formats","streams","downloads","results","videoStreams","audioStreams"]
    .forEach(k => {
      if(Array.isArray(data[k]) && data[k].length)
        lists.push({key:k, list:data[k]});
    });

  // Render lists
  if(lists.length === 0){
    container.innerHTML += `<div style="color:#faa;margin-top:10px">
       No downloadable media found.
    </div>`;
    return;
  }

  lists.forEach(block=>{
    const h = document.createElement("div");
    h.style.marginTop = "12px";
    h.style.fontWeight = "700";
    h.textContent = `${block.key} (${block.list.length})`;
    container.appendChild(h);

    block.list.forEach((it, idx)=>{
      const url = it.url || it.downloadUrl || it.streamUrl || it.mediaUrl || it.source;

      const q = it.quality || it.quality_label || it.format ||
                (it.width && it.height ? `${it.width}x${it.height}` : "Unknown");

      const mime = it.mimeType || it.extension || "";
      const size = it.sizeText || it.size || "";

      const row = document.createElement("div");
      row.className = "media";
      row.innerHTML = `
        <div class="left">
          <div style="font-weight:700">${escapeHtml(q)} ${mime?'• '+escapeHtml(mime):''}</div>
          <div style="color:#9fb6c8;font-size:13px">${escapeHtml(String(size))}</div>
        </div>
        ${
          url
          ? `<a class="link" target="_blank" href="${escapeAttr(url)}">Open</a>`
          : `<span style="color:#777">No URL</span>`
        }
      `;
      container.appendChild(row);
    });
  });
}

function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c])); }
function escapeAttr(s){ return String(s||'').replace(/"/g,'&quot;').replace(/`/g,'\\`'); }
</script>

</body>
</html>
