<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YouTube Downloader (RapidAPI) — Full Version</title>
<style>
  :root{--bg:#071428;--card:#071a2b;--accent:#06b6d4;--muted:#9fb6c8}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto;background:linear-gradient(180deg,#041025,#071429);color:#e8f7fb;padding:14px}
  .wrap{max-width:920px;margin:0 auto}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
  h1{margin:0 0 6px;font-size:19px}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  label{display:block;margin-top:14px;color:var(--muted);font-size:13px}
  input[type=url], input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);background:transparent;color:inherit}
  .row{display:flex;gap:8px;margin-top:8px}
  .btn{background:var(--accent);color:#022;padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .btn.sec{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
  .notice{font-size:13px;color:var(--muted);margin-top:8px}
  .result{margin-top:16px;display:grid;gap:10px}
  .media{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:rgba(255,255,255,0.04)}
  .media .left{max-width:66%}
  a.link{padding:8px 10px;border-radius:7px;background:rgba(6,182,212,0.15);color:#cfefff;text-decoration:none;font-weight:600}
  img.thumb{width:100%;max-width:160px;border-radius:8px}
  @media(max-width:600px){
     .row{flex-direction:column}
     .media{flex-direction:column;align-items:flex-start}
     a.link{margin-top:6px;display:block}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>YouTube Downloader (RapidAPI)</h1>
      <p class="lead">Paste API key → paste YouTube URL → click Fetch → get direct download links.</p>

      <!-- API KEY INPUT -->
      <label>RapidAPI Key</label>
      <div class="row">
        <input id="apiKey" type="text" placeholder="Paste RapidAPI key here" />
        <button id="saveKey" class="btn sec">Save</button>
      </div>

      <!-- VIDEO URL INPUT -->
      <label>YouTube URL / Video ID</label>
      <div class="row">
        <input id="videoInput" type="url" placeholder="https://www.youtube.com/watch?v=..." />
        <button id="fetchBtn" class="btn">Fetch</button>
      </div>

      <div id="status" class="notice"></div>
      <div id="info" class="result"></div>

      <div class="notice" style="margin-top:12px">
        ⚠ শিখার উদ্দেশ্যে — API key কখনো public-এ শেয়ার করবেন না।
      </div>
    </div>
  </div>

<script>
const API_HOST = "youtube-media-downloader.p.rapidapi.com";
const API_URL = "https://" + API_HOST + "/v2/video/details";

const videoInput = document.getElementById("videoInput");
const apiKeyEl = document.getElementById("apiKey");
const saveKeyBtn = document.getElementById("saveKey");
const fetchBtn = document.getElementById("fetchBtn");
const statusEl = document.getElementById("status");
const infoEl = document.getElementById("info");

// Load key (if saved)
if(localStorage.getItem("rapid_key"))
    apiKeyEl.value = localStorage.getItem("rapid_key");

// Save key
saveKeyBtn.addEventListener("click", ()=>{
  let k = apiKeyEl.value.trim();
  if(!k) return alert("Paste your API key first!");
  localStorage.setItem("rapid_key", k);
  status("API key saved locally.");
});

// Fetch button
fetchBtn.addEventListener("click", ()=> {
  const url = videoInput.value.trim();
  if(!url) return alert("Paste video URL or ID");

  const key = localStorage.getItem("rapid_key") || apiKeyEl.value.trim();
  if(!key) return alert("API key missing.");

  const videoId = extractID(url);
  if(!videoId) return alert("Invalid YouTube URL / ID");

  fetchVideo(videoId, key);
});

function status(msg){ statusEl.textContent = msg; }
function clear(){ infoEl.innerHTML = ""; status(""); }

// Extract video ID
function extractID(x){
  if(/^[A-Za-z0-9_-]{8,}$/.test(x) && !x.includes("/")) return x;
  try {
    const u = new URL(x);
    if(u.hostname.includes("youtu.be")) return u.pathname.slice(1);
    if(u.hostname.includes("youtube.com")){
      const v = u.searchParams.get("v");
      if(v) return v;
      const parts = u.pathname.split("/");
      const i = parts.indexOf("embed");
      if(i>=0 && parts[i+1]) return parts[i+1];
    }
  } catch(e){}
  return null;
}

// Fetch API
async function fetchVideo(videoId, key){
  clear();
  status("Fetching info...");

  const query = new URLSearchParams({
    videoId: videoId,
    urlAccess: "normal",
    videos: "auto",
    audios: "auto"
  });

  try{
    const r = await fetch(API_URL + "?" + query.toString(), {
      method: "GET",
      headers: {
        "x-rapidapi-host": API_HOST,
        "x-rapidapi-key": key
      }
    });

    const txt = await r.text();
    let data;
    try { data = JSON.parse(txt); }
    catch { data = txt; }

    console.log("FULL API RESPONSE:", data);

    display(data);
    status("Done.");
  }
  catch(e){
    status("Error: " + e.message);
    infoEl.innerHTML = "<div style='color:#f88'>Fetch failed: "+e.message+"</div>";
  }
}

// Render response
function display(data){
  infoEl.innerHTML = "";

  const title = data.title || data.name || "Unknown title";
  const thumb = data.thumbnail || data.thumb || "";
  const author = data.author || data.uploader || "";
  const dur = data.duration || "-";

  const head = document.createElement("div");
  head.style.display = "flex";
  head.style.gap = "12px";

  if(thumb){
    const img = document.createElement("img");
    img.src = thumb;
    img.className = "thumb";
    head.appendChild(img);
  }

  const meta = document.createElement("div");
  meta.innerHTML =
    `<div style="font-weight:700">${title}</div>
     <div style="color:#9fb6c8;font-size:13px">${author}</div>
     <div style="color:#9fb6c8;font-size:12px;margin-top:6px">Duration: ${dur} sec</div>`;
  head.appendChild(meta);

  infoEl.appendChild(head);

  // Try all possible fields
  const lists = [
    data.medias,
    data.formats,
    data.streams,
    data.results,
    data.downloads,
    data.videoStreams,
    data.audioStreams
  ].filter(x => Array.isArray(x) && x.length);

  // Direct single-url fallback
  const single =
    data.url ||
    data.videoUrl ||
    data.downloadUrl ||
    data.source ||
    null;

  if(single){
    infoEl.innerHTML += `
      <div class="media">
        <div class="left"><b>Direct Link</b></div>
        <a class="link" target="_blank" href="${single}">Download</a>
      </div>`;
  }

  if(lists.length===0 && !single){
    infoEl.innerHTML += `<div style="color:#faa;margin-top:12px">
       No downloadable media found. Check console for API response.
    </div>`;
    return;
  }

  lists.forEach(list=>{
    list.forEach(m => {
      const url =
        m.url || m.downloadUrl || m.source || m.streamUrl || m.link;

      const q = m.quality || m.quality_label || m.format_note || "";
      const ext = m.ext || m.extension || "";
      const size = m.data_size || m.filesize || m.size || "";

      const div = document.createElement("div");
      div.className = "media";

      div.innerHTML = `
        <div class="left">
          <div style="font-weight:700">${q} ${ext?("• "+ext):""}</div>
          <div style="color:#9fb6c8;font-size:13px">
             ${size? (Math.round(size/1024/1024)+' MB') : ''}
          </div>
        </div>
        ${url ? `<a class="link" target="_blank" href="${url}">Download</a>`
              : `<span style="color:#999">No URL</span>`}
      `;

      infoEl.appendChild(div);
    });
  });
}
</script>

</body>
</html>
